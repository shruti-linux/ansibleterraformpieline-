name: SHRUTI

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: self-hosted

    env:
      #TF_VAR_project_id:        "ansi-465711"
      #TF_VAR_credentials_file:  "/home/shruti/ansi-terra/actions-runner/_work/ansibleterraformpieline-/ansibleterraformpieline-/terraform-ansible/sa.json"
      TF_VAR_public_key_path:   "/home/shruti/.ssh/id_rsa.pub"

    defaults:
      run:
        working-directory: /home/shruti/ansi-terra   # all steps use this folder

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4


      
      - name: Prepare Ansible inventory
        run: |
          cd /home/shruti/ansi-terra/abc/
          echo "[centos9]" > inventory
          if [ -s ip.txt ]; then
            while IFS= read -r ip; do
              echo "$ip ansible_user=shrutikulshreshta  become_method=sudo host_key_checking=False ansible_ssh_private_key_file=home/shruti/.ssh/id_rsa ansible_python_interpreter=/usr/bin/python3 ansible_become=true" >> inventory
            done < ip.txt
          else
            echo "ip.txt is empty!"
          fi
  
    


       
      
      - name: Run Ansible Playbook
        run: |
          cd /home/shruti/ansi-terra/abc
          ansible-playbook -i inventory playbook1-adduser.yaml --become
          
   

      
